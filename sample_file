This is main file from daniel branch